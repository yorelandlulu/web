<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kun.flow.data.PermitMapper">
	<resultMap id="PermitResultMap" type="com.kun.flow.model.Permit">
		<!-- WARNING - @mbggenerated This element is automatically generated by MyBatis Generator, do not modify. This element 
			was generated on Thu Apr 24 23:56:12 CST 2014. -->
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="code" property="code" jdbcType="VARCHAR" />
		<result column="leaf" property="leaf" jdbcType="INTEGER" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="ordinal" property="ordinal" jdbcType="INTEGER" />
	</resultMap>
	<!-- ======================================================== -->
	<!-- hibernate-oracle分页的处理方式 -->
	<!-- select * from ( select row_.*, rownum rownum_ from ( select * from table ) row_ where rownum <= ? ) where rownum_ > 
		? -->
	<sql id="Permit_Columns">
		id, name, code, leaf, status, ordinal
	</sql>

	<!-- 增加 -->
	<insert id="save" parameterType="com.kun.flow.model.Permit">
	</insert>
	<!-- 修改 -->
	<update id="update" parameterType="com.kun.flow.model.Permit">
	</update>
	<!-- 删除 -->
	<delete id="delete" parameterType="com.kun.flow.model.Permit">
	</delete>
	<delete id="deleteAll">
	</delete>
	<delete id="deleteByKey" parameterType="java.io.Serializable">
	</delete>
	<!-- 查询 -->
	<select id="getByKey" resultMap="PermitResultMap" parameterType="java.io.Serializable">
	</select>
	<select id="findByExample" resultMap="PermitResultMap" parameterType="com.kun.flow.model.Permit">
	</select>
	<select id="findOnePageByExample" resultMap="PermitResultMap" parameterType="map">
	</select>
	<select id="findOneByExample" resultMap="PermitResultMap" parameterType="com.kun.flow.model.Permit">
	</select>
	<select id="loadAll" resultMap="PermitResultMap" parameterType="com.kun.flow.model.Permit">
		<!-- 当Permit对象为null需要测试 -->
		select
		<include refid="Permit_Columns" />
		from permit where status=1 order by ordinal asc
	</select>
	<select id="loadOnePage" resultMap="PermitResultMap" parameterType="com.kun.flow.bean.Pagination">
		<!-- 当Permit对象为null需要测试 -->
		select
		<include refid="Permit_Columns" />
		from permit
	</select>
	<select id="listPermitsByOperater" resultMap="PermitResultMap" parameterType="java.io.Serializable">
		select
		<include refid="Permit_Columns" />
		from permit where status=1 and id in(select permitId from role_bind_permit as rbp where rbp.roleId in( select
		obr.roleId from
		operater_bind_role as obr
		where obr.userId=#{key})) order by ordinal
	</select>
	<select id="listPermitsByRole" resultMap="PermitResultMap" parameterType="java.io.Serializable">
		select
		<include refid="Permit_Columns" />
		from permit where status=1 and id in(select permitId from role_bind_permit as rbp where rbp.roleId = #{key}) order
		by
		ordinal
	</select>
	<select id="listUnbindPermitsByRole" resultMap="PermitResultMap" parameterType="java.io.Serializable">
		select
		<include refid="Permit_Columns" />
		from permit where status=1 and (leaf = 0 or (id not in(select permitId from role_bind_permit as rbp where rbp.roleId =
		#{key}))) order by ordinal
	</select>
	<select id="getCount" resultType="int">
	</select>
	<select id="getCountByExample" resultType="int" parameterType="com.kun.flow.model.Permit">
	</select>
	<select id="getCountForSearch" resultType="int" parameterType="com.kun.flow.model.Permit">
	</select>
	<!-- ======================================================== -->
</mapper>